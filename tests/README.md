# –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –î–û–ü–†–û–° MVP 2.0

–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —ç–º–æ—Ü–∏–π.

## üß™ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –º–æ–¥—É–ª–∏

- **`test_compatibility.py`** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- **`test_pipeline.py`** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–∞–π–ø–ª–∞–π–Ω–∞
- **`test_models.py`** - –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

- **`fixtures/conftest.py`** - –§–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- **`fixtures/test_data_generator.py`** - –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **`pytest.ini`** - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
- **`run_tests.py`** - –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source venv/bin/activate

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
pip install pytest pytest-cov pytest-mock pytest-asyncio psutil
```

### 2. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫
pytest tests/ -v

# –° –∞–Ω–∞–ª–∏–∑–æ–º –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞
pytest tests/ -v --cov=core --cov=models --cov-report=html

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞
python run_tests.py --type all --coverage
```

### 3. –ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ç–µ—Å—Ç–æ–≤

```bash
# –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
python run_tests.py --type compatibility

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π
python run_tests.py --type models

# –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
python run_tests.py --type integration
```

## üìã –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### üîß –¢–µ—Å—Ç—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (`test_compatibility.py`)

–ü—Ä–æ–≤–µ—Ä—è—é—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

- ‚úÖ –í–µ—Ä—Å–∏—è Python
- ‚úÖ –ù–∞–ª–∏—á–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ò–º–ø–æ—Ä—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å GPU/CUDA
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ FFmpeg
- ‚úÖ API –∫–ª—é—á–∏
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π YOLO
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

**–ó–∞–ø—É—Å–∫:**
```bash
pytest tests/test_compatibility.py -v
python run_tests.py --setup-only
```

### üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (`test_pipeline.py`)

–¢–µ—Å—Ç–∏—Ä—É—é—Ç –ø–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏:

- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ –∏ –∞—É–¥–∏–æ
- ‚úÖ Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫
- ‚úÖ –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ó–∞–ø—É—Å–∫:**
```bash
pytest tests/test_pipeline.py -v
python run_tests.py --type pipeline
```

### ü§ñ –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π (`test_models.py`)

–¢–µ—Å—Ç–∏—Ä—É—é—Ç ML –º–æ–¥–µ–ª–∏:

- ‚úÖ –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Ä–µ—á–∏
- ‚úÖ YOLO –¥–µ—Ç–µ–∫—Ü–∏—è –ª–∏—Ü
- ‚úÖ –ê–Ω–∞–ª–∏–∑ —ç–º–æ—Ü–∏–π (DeepFace, FER)
- ‚úÖ Fallback –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–µ–π

**–ó–∞–ø—É—Å–∫:**
```bash
pytest tests/test_models.py -v
python run_tests.py --type models
```

## üè∑Ô∏è –ú–∞—Ä–∫–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã

- `@pytest.mark.slow` - –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (> 10 —Å–µ–∫)
- `@pytest.mark.gpu` - –¢—Ä–µ–±—É—é—Ç GPU
- `@pytest.mark.integration` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- `@pytest.mark.unit` - –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
- `@pytest.mark.performance` - –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤

```bash
# –ò—Å–∫–ª—é—á–∏—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest -m "not slow"

# –¢–æ–ª—å–∫–æ GPU —Ç–µ—Å—Ç—ã
pytest -m "gpu"

# –¢–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
pytest -m "unit and not slow"
```

## üìä –ê–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞

```bash
# HTML –æ—Ç—á–µ—Ç
pytest --cov=core --cov=models --cov-report=html

# –¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
pytest --cov=core --cov=models --cov-report=term-missing

# –¢–æ–ª—å–∫–æ –ø–æ–∫—Ä—ã—Ç–∏–µ –±–µ–∑ —Ç–µ—Å—Ç–æ–≤
coverage report -m
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
# –û—Ç–∫—Ä—ã—Ç—å HTML –æ—Ç—á–µ—Ç
open htmlcov/index.html  # macOS
xdg-open htmlcov/index.html  # Linux
```

## üõ†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

```python
from tests.fixtures.test_data_generator import TestDataGenerator

generator = TestDataGenerator()

# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –≤–∏–¥–µ–æ
generator.create_test_video("test.mp4", duration=5, fps=2)

# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –∞—É–¥–∏–æ
generator.create_test_audio("test.wav", duration=5, audio_type="speech")

# –°–æ–∑–¥–∞—Ç—å –¥–∞—Ç–∞—Å–µ—Ç —ç–º–æ—Ü–∏–π
emotion_data = generator.create_emotion_dataset(100)
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä

```python
def test_with_fixtures(test_video_file, test_audio_file, test_config):
    """–¢–µ—Å—Ç —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≥–æ—Ç–æ–≤—ã—Ö —Ñ–∏–∫—Å—Ç—É—Ä"""
    pipeline = MasterPipeline(test_config)
    result = pipeline.process_video(test_video_file)
    assert result is not None
```

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ë–µ–Ω—á–º–∞—Ä–∫–∏

```bash
# –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
pytest -m "performance" -v

# –° –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º
pytest --profile-svg
```

### –û–∂–∏–¥–∞–µ–º—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ**: < 2 —Å–µ–∫/–∫–∞–¥—Ä
- **–ê–Ω–∞–ª–∏–∑ –∞—É–¥–∏–æ**: < 0.5 —Å–µ–∫/—Å–µ–∫ –∞—É–¥–∏–æ
- **–î–µ—Ç–µ–∫—Ü–∏—è —ç–º–æ—Ü–∏–π**: < 0.5 —Å–µ–∫/–ª–∏—Ü–æ
- **–ü–∞–º—è—Ç—å**: < 500 MB –¥–ª—è –≤–∏–¥–µ–æ 1080p

## üêõ –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥

```bash
# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è
pytest -vvv -s --tb=long

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
pytest -x

# –ó–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —É–ø–∞–≤—à–∏—Ö —Ç–µ—Å—Ç–æ–≤
pytest --lf
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
pytest --log-cli-level=DEBUG

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª
pytest --log-file=test.log
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (`pytest.ini`)

```ini
[tool:pytest]
testpaths = tests
markers = 
    slow: –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
    gpu: —Ç–µ—Å—Ç—ã –¥–ª—è GPU
    integration: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
addopts = --verbose --strict-markers --tb=short
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
export PYTHONPATH=.
export CUDA_VISIBLE_DEVICES=""  # –û—Ç–∫–ª—é—á–∏—Ç—å GPU –¥–ª—è —Ç–µ—Å—Ç–æ–≤
export TF_CPP_MIN_LOG_LEVEL=3   # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ TensorFlow
```

## üìà Continuous Integration

### GitHub Actions

```yaml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install pytest pytest-cov
      - name: Run tests
        run: python run_tests.py --type all --coverage
```

## üìù –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞

```python
import pytest
from unittest.mock import Mock, patch

class TestNewFeature:
    """–¢–µ—Å—Ç—ã –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏"""
    
    def test_basic_functionality(self):
        """–ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏"""
        # Arrange
        input_data = "test"
        
        # Act
        result = new_function(input_data)
        
        # Assert
        assert result is not None
    
    @pytest.mark.slow
    def test_performance(self):
        """–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
        import time
        start = time.time()
        
        # –í—ã–ø–æ–ª–Ω—è–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é
        heavy_operation()
        
        duration = time.time() - start
        assert duration < 10.0  # –ù–µ –±–æ–ª–µ–µ 10 —Å–µ–∫—É–Ω–¥
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–û–¥–∏–Ω —Ç–µ—Å—Ç = –æ–¥–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞**
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞**
3. **–î–æ–±–∞–≤–ª—è–π—Ç–µ –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏**
4. **–ú–æ–∫–∏—Ä—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
5. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏**
6. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**

## üÜò –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

**1. Import Error**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ PYTHONPATH
export PYTHONPATH=.
pytest tests/
```

**2. CUDA –æ—à–∏–±–∫–∏**
```bash
# –û—Ç–∫–ª—é—á–∏—Ç–µ GPU –¥–ª—è —Ç–µ—Å—Ç–æ–≤
export CUDA_VISIBLE_DEVICES=""
pytest tests/
```

**3. –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**
```bash
# –ò—Å–∫–ª—é—á–∏—Ç–µ –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest -m "not slow"
```

**4. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –ø–∞–º—è—Ç–∏**
```bash
# –ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
pytest -n 1
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
pytest --collect-only

# –°–ø–∏—Å–æ–∫ –º–∞—Ä–∫–µ—Ä–æ–≤
pytest --markers

# –°–ø—Ä–∞–≤–∫–∞ –ø–æ –æ–ø—Ü–∏—è–º
pytest --help

# –í–µ—Ä—Å–∏—è pytest
pytest --version
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è pytest](https://docs.pytest.org/)
- [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é ML](https://madewithml.com/courses/mlops/testing/)
- [Pytest-cov –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://pytest-cov.readthedocs.io/)
- [–ú–æ–∫–∏ –≤ Python](https://docs.python.org/3/library/unittest.mock.html)